# Apex Liquid Bot 算法文档总览

## 📚 文档列表

本项目包含 7 个核心交易分析指标的详细算法文档，每个文档都包含：
- 算法概述和核心概念
- 详细的计算公式和推导
- 完整的代码实现（含注释）
- 实际应用场景
- 完整的测试用例

---

## 🎯 核心指标文档

### 1. [净入金算法详解](./净入金算法详解.md)

**指标名称**: True Capital（真实本金）

**核心公式**:
```python
true_capital = deposits - withdrawals + external_to_spot - external_out
```

**指标意义**:
- 计算用户实际投入的净资金量
- 排除交易盈亏的影响
- 准确反映资金流入流出

**应用场景**:
- 计算累计收益率的分母
- 计算夏普比率时的基准
- 计算最大回撤时的基准

**关键特性**:
- ✅ 排除交易盈亏，只计算资金流动
- ✅ 智能识别内部转账（Perp ↔ Spot）
- ✅ 支持充值、提现、外部转入转出

---

### 2. [盈亏因子算法详解](./盈亏因子算法详解.md)

**指标名称**: Profit Factor（盈亏因子）

**核心公式**:
```python
profit_factor = total_gains / total_losses
```

**指标意义**:
- 评估交易策略盈利能力
- > 1 表示盈利，< 1 表示亏损
- 数值越高，策略越优秀

**评级标准**:
- < 1.0: ❌ 不可接受
- 1.0 - 1.5: ⚠️ 勉强可接受
- 1.5 - 2.0: ✅ 良好
- 2.0 - 3.0: 🌟 优秀
- \> 3.0: 🏆 卓越

**关键特性**:
- ✅ 同时考虑已实现和未实现盈亏
- ✅ 高精度计算（50位精度）
- ✅ 特殊处理无亏损、无盈利等边界情况

---

### 3. [胜率统计算法详解](./胜率统计算法详解.md)

**指标名称**: Win Rate（胜率）

**核心公式**:
```python
win_rate = (winning_trades / total_trades) * 100
bias = ((long_trades - short_trades) / total_trades * 100 + 100) / 2
```

**指标意义**:
- 评估交易准确性
- 反映盈利交易占比
- 分析多空方向偏好

**方向偏好**:
- bias = 50: 多空平衡
- bias > 50: 偏多头
- bias < 50: 偏空头

**关键特性**:
- ✅ 准确识别交易方向（含翻仓）
- ✅ 零盈亏交易不计入胜率
- ✅ 大小写兼容的方向判断

---

### 4. [夏普比率算法详解](./夏普比率算法详解.md)

**指标名称**: Sharpe Ratio（夏普比率）

**核心公式**:
```python
sharpe_ratio = (mean_return - risk_free_rate) / std_dev
annualized_sharpe = sharpe_per_trade × √(trades_per_year)
```

**指标意义**:
- 衡量风险调整后的收益
- 承担每单位风险的超额收益
- 值越高，风险收益比越好

**评级标准**:
- < 0: ❌ 差
- 0 - 1: ⚠️ 一般
- 1 - 2: ✅ 良好
- 2 - 3: 🌟 优秀
- \> 3: 🏆 卓越

**关键特性**:
- ✅ 基于真实本金，不受杠杆影响
- ✅ 使用复利计算年化
- ✅ 与累计收益率逻辑一致

---

### 5. [最大回撤算法详解](./最大回撤算法详解.md)

**指标名称**: Max Drawdown（最大回撤）

**核心公式**:
```python
drawdown = (peak - current_value) / peak × 100%
max_drawdown = max(all_drawdowns)
```

**指标意义**:
- 评估最坏情况下的损失
- 从峰值到谷底的最大跌幅
- 反映风险承受能力

**风险评级**:
- < 10%: 🏆 优秀
- 10% - 20%: ✅ 良好
- 20% - 30%: ⚠️ 可接受
- 30% - 50%: ❌ 高风险
- \> 50%: 🚨 极高风险

**关键特性**:
- ✅ 基于真实本金计算
- ✅ 复利累计收益率序列
- ✅ 记录峰值和谷底时间

---

### 6. [累计收益率算法详解](./累计收益率算法详解.md)

**指标名称**: Cumulative Return & Annualized Return（累计收益率和年化收益率）

**核心公式**:
```python
cumulative_return = (total_pnl / true_capital) × 100%
annualized_return = ((1 + cumulative_return) ^ (365 / days) - 1) × 100%
```

**指标意义**:
- 累计收益率：总体表现
- 年化收益率：标准化对比

**计算特点**:
- 使用累计总盈亏（已实现 + 未实现）
- 基于净入金计算
- 复利年化（非简单线性）

**关键特性**:
- ✅ 不受出入金影响
- ✅ 包含未实现盈亏
- ✅ 自动标记短期数据可靠性

---

### 7. [持仓时间统计算法详解](./持仓时间统计算法详解.md)

**指标名称**: Hold Time Statistics（持仓时间统计）

**核心公式**:
```python
hold_time_days = (close_time - open_time) / 86400000
average_hold_time = Σ(hold_time_i) / n
```

**指标意义**:
- 识别交易风格
- 评估资金效率
- 优化策略参数

**交易风格**:
- < 1 小时: 超短线 / 高频
- 1-24 小时: 日内交易
- 1-7 天: 短线交易
- 7-30 天: 中线交易
- \> 30 天: 长线交易

**关键特性**:
- ✅ 多空分离配对
- ✅ 支持部分平仓
- ✅ FIFO 先进先出原则
- ✅ 正确处理翻仓交易

---

## 📊 指标关系图

```
净入金 (True Capital)
   ↓
   ├─→ 累计收益率 = 累计总盈亏 / 净入金
   │      ↓
   │      └─→ 年化收益率 (复利计算)
   │
   ├─→ 夏普比率 = (平均收益率 - 无风险利率) / 标准差
   │      ↓
   │      └─→ 年化夏普比率
   │
   └─→ 最大回撤 = (峰值 - 谷底) / 峰值
          ↓
          └─→ 卡玛比率 = 年化收益率 / 最大回撤

交易记录 (Fills)
   ↓
   ├─→ 盈亏因子 = 总盈利 / 总亏损
   ├─→ 胜率 = 盈利次数 / 总次数
   └─→ 持仓时间统计 (FIFO 配对)
```

---

## 🔧 算法特点对比

| 指标 | 需要净入金 | 需要持仓数据 | 受杠杆影响 | 复杂度 |
|------|-----------|------------|-----------|--------|
| **净入金** | ❌ | ❌ | ❌ | 中 |
| **盈亏因子** | ❌ | ✅ | ❌ | 低 |
| **胜率统计** | ❌ | ❌ | ❌ | 中 |
| **夏普比率** | ✅ | ❌ | ❌ | 高 |
| **最大回撤** | ✅ | ❌ | ❌ | 高 |
| **累计收益率** | ✅ | ✅ | ❌ | 中 |
| **持仓时间** | ❌ | ❌ | ❌ | 高 |

---

## 💡 使用建议

### 1. 快速评估（3个指标）

```python
# 最少需要这3个指标了解策略基本情况
1. 盈亏因子：盈利能力
2. 胜率：交易准确性
3. 累计收益率：总体表现
```

### 2. 全面评估（7个指标）

```python
# 完整的策略评估体系
1. 净入金：资金基准
2. 盈亏因子：盈利能力
3. 胜率：交易准确性
4. 夏普比率：风险调整后收益
5. 最大回撤：风险水平
6. 累计收益率：总体表现
7. 持仓时间：交易风格
```

### 3. 指标组合分析

#### 组合 A：高胜率 + 低盈亏比
```
胜率 = 70%，盈亏因子 = 1.2
→ 虽然胜率高，但单笔盈亏比不足
→ 建议：提高止盈目标，降低止损频率
```

#### 组合 B：低胜率 + 高盈亏比
```
胜率 = 40%，盈亏因子 = 3.0
→ 少赢多亏，但赢时赢很多
→ 这是趋势跟踪策略的典型特征
```

#### 组合 C：高收益 + 高回撤
```
年化收益率 = 100%，最大回撤 = 50%
→ 高收益伴随高风险
→ 建议：降低仓位或优化止损策略
```

---

## 📖 文档使用指南

### 阅读顺序建议

#### 初学者
1. 先读 **净入金算法** - 理解资金计算基础
2. 再读 **盈亏因子** 和 **胜率统计** - 了解基本盈利指标
3. 最后读 **累计收益率** - 掌握收益计算

#### 进阶用户
1. 重点阅读 **夏普比率** - 理解风险调整
2. 深入学习 **最大回撤** - 掌握风险评估
3. 研究 **持仓时间** - 优化交易策略

### 代码集成

每个文档都包含完整的可运行代码，可以：
1. 直接复制到项目中使用
2. 根据需求修改和扩展
3. 参考测试用例进行验证

---

## 🔗 相关资源

- **项目源码**: apex_fork.py
- **API 文档**: https://hyperliquid.gitbook.io/hyperliquid-docs/for-developers/api
- **Apex Liquid Bot**: https://apexliquid.bot/

---

## 📝 更新日志

### v1.0 (2026-02-03)
- ✅ 完成 7 个核心指标文档
- ✅ 每个文档包含完整代码实现
- ✅ 提供详细的测试用例
- ✅ 添加应用场景说明

---

## 📧 联系方式

如有问题或建议，请联系：
- Email: support@apexcalculator.com
- GitHub: https://github.com/apex-calculator

---

**文档生成时间**: 2026-02-03
**作者**: Apex Calculator Team
**版本**: v1.0
