# ç´¯è®¡æ”¶ç›Šç‡ç®—æ³•æ ¹æœ¬æ€§é—®é¢˜åˆ†æ

## é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šï¼š**ç´¯è®¡æ”¶ç›Šç‡å’Œç´¯è®¡PNLæ˜æ˜¾å¯¹ä¸ä¸Š**

```
ç´¯è®¡æ€»ç›ˆäº: $20,744.00  (æ­£çš„) âœ…
ç´¯è®¡æ”¶ç›Šç‡: -5008.87%   (è´Ÿçš„) âŒ

ä¿®å¤åï¼š
ç´¯è®¡æ”¶ç›Šç‡: -82.76%     (ä»ç„¶è´Ÿçš„) âŒ
```

## é—®é¢˜æ ¹æº

### 1. ç®—æ³•å‡è®¾ä¸å®é™…ä¸ç¬¦

**å½“å‰ç®—æ³•**ï¼š
```python
cumulative = 1.0
for ret in trade_returns:
    cumulative *= (1 + ret)
cumulative_return = (cumulative - 1) * 100
```

**ç®—æ³•å‡è®¾**ï¼š
- æ¯ç¬”äº¤æ˜“éƒ½ä½¿ç”¨**å…¨éƒ¨èµ„é‡‘**
- å‰ä¸€ç¬”çš„æ”¶ç›Šä¼šæˆä¸ºä¸‹ä¸€ç¬”çš„"æœ¬é‡‘"
- ç¬¦åˆå…¸å‹çš„æŠ•èµ„ç»„åˆå¤åˆ©å¢é•¿æ¨¡å‹

**å®é™…æƒ…å†µ**ï¼š
- æ¯ç¬”äº¤æ˜“åªä½¿ç”¨**ä¸€éƒ¨åˆ†èµ„é‡‘**ï¼ˆæŒä»“ä»·å€¼ â‰  æ€»èµ„é‡‘ï¼‰
- ä¸åŒäº¤æ˜“çš„æŒä»“ä»·å€¼å·®å¼‚å·¨å¤§ï¼ˆæœ€å°$10ï¼Œæœ€å¤§$19,706ï¼‰
- å¤§é¢äºæŸäº¤æ˜“åœ¨å¤åˆ©é“¾ä¸­é€ æˆ"å·¨å‘"ï¼Œå³ä½¿åç»­å¤§é‡å°é¢ç›ˆåˆ©ä¹Ÿæ— æ³•å¡«å¹³

### 2. æ•°æ®åˆ†æ

**æ€»ä½“æ•°æ®**ï¼š
- æ€»äº¤æ˜“æ•°ï¼š618 ç¬”ï¼ˆæœ‰ closedPnL çš„äº¤æ˜“ï¼‰
- æ€»ç›ˆäºï¼š**$20,744**ï¼ˆæ­£çš„ï¼‰
- ç›ˆåˆ©äº¤æ˜“ï¼š539 ç¬”ï¼Œæ€»è®¡ **$33,203**
- äºæŸäº¤æ˜“ï¼š79 ç¬”ï¼Œæ€»è®¡ **-$12,459**

**æ”¶ç›Šç‡ç»Ÿè®¡**ï¼š
- ç®€å•å¹³å‡æ”¶ç›Šç‡ï¼š**1.22%**ï¼ˆæ­£çš„ï¼‰âœ…
- åŠ æƒå¹³å‡æ”¶ç›Šç‡ï¼š**1.19%**ï¼ˆæ­£çš„ï¼‰âœ…
- å¤åˆ©ç´¯è®¡æ”¶ç›Šç‡ï¼š**-82.76%**ï¼ˆè´Ÿçš„ï¼‰âŒ

**é—®é¢˜äº¤æ˜“åˆ†å¸ƒ**ï¼š
```
æ”¶ç›Šç‡åŒºé—´          äº¤æ˜“æ•°    æ€»ç›ˆäº
-99.9% ~ -50%      5 ç¬”     -$9,623.69  âš ï¸ é—®é¢˜æ‰€åœ¨
-20% ~ -10%        3 ç¬”     -$1,868.25
-5% ~ 0%          71 ç¬”       -$967.11
0% ~ 5%          480 ç¬”     +$6,163.18
10% ~ 20%         52 ç¬”    +$22,831.31
20% ~ 50%          5 ç¬”     +$3,476.02
50% ~ 100%         1 ç¬”        +$61.07
```

### 3. å¤åˆ©"å·¨å‘"æ•ˆåº”ç¤ºä¾‹

**åºå·17äº¤æ˜“**ï¼ˆæœ€å¤§äºæŸï¼‰ï¼š
- äºæŸï¼š-$5,184
- æŒä»“ä»·å€¼ï¼š$7,425
- æ”¶ç›Šç‡ï¼š-69.82%
- å¤åˆ©å½±å“ï¼šcumulative *= (1 + (-0.6982)) = cumulative * 0.3018

å³ä½¿è¿™ä¸€ç¬”äº¤æ˜“åï¼Œèµ„é‡‘å˜æˆåŸæ¥çš„ **30.18%**ï¼Œæ„å‘³ç€éœ€è¦åç»­æœ‰ **+231%** çš„æ”¶ç›Šæ‰èƒ½å›æœ¬ï¼

ä½†åç»­å¤§éƒ¨åˆ†æ˜¯å°é¢ç›ˆåˆ©ï¼ˆ0% ~ 5%ï¼‰ï¼Œæ ¹æœ¬æ— æ³•å¡«è¡¥è¿™ä¸ª"å‘"ã€‚

### 4. ä¸ºä»€ä¹ˆæ€»ç›ˆäºæ˜¯æ­£çš„ï¼Œä½†å¤åˆ©æ”¶ç›Šç‡æ˜¯è´Ÿçš„ï¼Ÿ

**å…³é”®**ï¼šä¸åŒäº¤æ˜“ä½¿ç”¨çš„èµ„é‡‘é‡ï¼ˆæŒä»“ä»·å€¼ï¼‰ä¸åŒã€‚

**ç®€åŒ–ç¤ºä¾‹**ï¼š
```
äº¤æ˜“1ï¼šæŒä»“ä»·å€¼ $10,000ï¼ŒäºæŸ -70%ï¼ŒPnL = -$7,000
       å¤åˆ©å½±å“ï¼šcumulative = 1.0 * 0.3 = 0.3

äº¤æ˜“2ï¼šæŒä»“ä»·å€¼ $1,000ï¼Œç›ˆåˆ© +10%ï¼ŒPnL = +$100
       å¤åˆ©å½±å“ï¼šcumulative = 0.3 * 1.1 = 0.33

äº¤æ˜“3ï¼šæŒä»“ä»·å€¼ $1,000ï¼Œç›ˆåˆ© +10%ï¼ŒPnL = +$100
       å¤åˆ©å½±å“ï¼šcumulative = 0.33 * 1.1 = 0.363

... (é‡å¤å¤šæ¬¡å°é¢ç›ˆåˆ©)

æœ€ç»ˆï¼š
- æ€»ç›ˆäº = -$7,000 + $100 + $100 + ... å¯èƒ½æ˜¯æ­£çš„
- å¤åˆ©ç´¯è®¡æ”¶ç›Šç‡ = (0.3xx - 1) * 100 = -67% (è´Ÿçš„)
```

**åŸå› **ï¼š
- å¤åˆ©è®¡ç®—å¯¹æ¯ç¬”äº¤æ˜“ä¸€è§†åŒä»
- ä½†å®é™…ä¸Šï¼Œå¤§é¢äºæŸçš„"æƒé‡"ä¸åº”è¯¥è¿™ä¹ˆå¤§
- å› ä¸ºå®ƒåªä»£è¡¨éƒ¨åˆ†èµ„é‡‘çš„äºæŸï¼Œä¸æ˜¯å…¨éƒ¨èµ„é‡‘

## ç®—æ³•çš„æ ¹æœ¬æ€§ç¼ºé™·

**ç»“è®º**ï¼š**åŸºäºæŒä»“ä»·å€¼çš„å¤åˆ©ç´¯è®¡æ”¶ç›Šç‡ç®—æ³•ä¸é€‚åˆè¡¡é‡æ€»ä½“è¡¨ç°ï¼**

**ä¸ºä»€ä¹ˆï¼Ÿ**

1. **å¤åˆ©å‡è®¾ä¸æˆç«‹**
   - å¤åˆ©è®¡ç®—å‡è®¾æ¯æ¬¡äº¤æ˜“ä½¿ç”¨å…¨éƒ¨èµ„é‡‘
   - ä½†å®é™…æ¯ç¬”äº¤æ˜“çš„æŒä»“ä»·å€¼åªæ˜¯ä¸€éƒ¨åˆ†èµ„é‡‘

2. **æ— æ³•åæ˜ çœŸå®èµ„é‡‘å¢é•¿**
   - çœŸå®çš„èµ„é‡‘å¢é•¿ = æ€»ç›ˆäº / åˆå§‹èµ„é‡‘
   - è€Œä¸æ˜¯åŸºäºæŒä»“ä»·å€¼çš„å¤åˆ©ç´¯è®¡

3. **å¯¹å¤§é¢äºæŸè¿‡åº¦æ•æ„Ÿ**
   - ä¸€ç¬”å¤§é¢äºæŸï¼ˆç›¸å¯¹æŒä»“ä»·å€¼ï¼‰ä¼šåœ¨å¤åˆ©é“¾ä¸­é€ æˆå·¨å¤§å½±å“
   - å³ä½¿åç»­æœ‰å¾ˆå¤šå°é¢ç›ˆåˆ©ä¹Ÿæ— æ³•å¼¥è¡¥

4. **ä¸åŒäº¤æ˜“çš„"æƒé‡"é”™è¯¯**
   - åº”è¯¥æŒ‰ç…§å®é™…èµ„é‡‘ä½¿ç”¨é‡æ¥åŠ æƒ
   - è€Œä¸æ˜¯åœ¨å¤åˆ©é“¾ä¸­å¹³ç­‰å¯¹å¾…

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šåºŸé™¤å¤åˆ©ç´¯è®¡æ”¶ç›Šç‡ â­ æ¨è

**åŸå› **ï¼šè¿™ä¸ªæŒ‡æ ‡åœ¨å½“å‰æ•°æ®ç»“æ„ä¸‹æ²¡æœ‰æ„ä¹‰ã€‚

**æ›¿ä»£æŒ‡æ ‡**ï¼š
1. **ç®€å•å¹³å‡æ”¶ç›Šç‡**ï¼š1.22%
2. **åŠ æƒå¹³å‡æ”¶ç›Šç‡**ï¼š1.19% (= æ€»ç›ˆäº / æ€»æŒä»“ä»·å€¼)
3. **Sharpe Ratio**ï¼šå·²ç»åœ¨ä½¿ç”¨ï¼Œæ›´ç§‘å­¦

**ä¿®æ”¹**ï¼š
- ä»è¾“å‡ºä¸­ç§»é™¤"ç´¯è®¡æ”¶ç›Šç‡"
- ä¿ç•™"å¹³å‡æ¯ç¬”æ”¶ç›Šç‡"ï¼ˆç®€å•å¹³å‡ï¼‰
- æ·»åŠ è¯´æ˜ï¼šä¸ºä»€ä¹ˆä¸ä½¿ç”¨ç´¯è®¡æ”¶ç›Šç‡

### æ–¹æ¡ˆBï¼šä½¿ç”¨è´¦æˆ·èµ„é‡‘çš„çœŸå®æ”¶ç›Šç‡

**å…¬å¼**ï¼š
```
ç´¯è®¡æ”¶ç›Šç‡ = (å½“å‰è´¦æˆ·ä»·å€¼ - åˆå§‹æœ¬é‡‘) / åˆå§‹æœ¬é‡‘ Ã— 100%
```

**éœ€è¦çš„æ•°æ®**ï¼š
- åˆå§‹æœ¬é‡‘ï¼ˆéœ€è¦ä»å†å²æ•°æ®æ¨ç®—ï¼‰
- å‡ºå…¥é‡‘è®°å½•ï¼ˆéœ€è¦å®Œæ•´çš„è´¦æœ¬ï¼‰

**é—®é¢˜**ï¼š
- å½“å‰ç³»ç»Ÿè®¾è®¡å°±æ˜¯ä¸ºäº†**ä¸ä¾èµ–æœ¬é‡‘æ•°æ®**
- è¿™è¿èƒŒäº†è®¾è®¡åˆè¡·

### æ–¹æ¡ˆCï¼šåŸºäºè´¦æˆ·ä»·å€¼å˜åŒ–çš„ç´¯è®¡æ”¶ç›Šç‡

**å…¬å¼**ï¼š
```
æ¯ä¸ªæ—¶é—´ç‚¹çš„è´¦æˆ·ä»·å€¼ = ä¸Šä¸€æ—¶é—´ç‚¹ä»·å€¼ + PnL
ç´¯è®¡æ”¶ç›Šç‡ = (æœ€ç»ˆè´¦æˆ·ä»·å€¼ - åˆå§‹è´¦æˆ·ä»·å€¼) / åˆå§‹è´¦æˆ·ä»·å€¼
```

**é—®é¢˜**ï¼š
- éœ€è¦å‡è®¾åˆå§‹è´¦æˆ·ä»·å€¼
- å—å‡ºå…¥é‡‘å½±å“

## æ¨èå®æ–½æ–¹æ¡ˆ

### æ­¥éª¤1ï¼šç§»é™¤è¯¯å¯¼æ€§æŒ‡æ ‡

ä» `main.py` å’Œ `report_generator.py` ä¸­ç§»é™¤ï¼š
- âŒ ç´¯è®¡æ”¶ç›Šç‡ï¼ˆåŸºäºå¤åˆ©ï¼‰
- âŒ å¹´åŒ–æ”¶ç›Šç‡ï¼ˆåŸºäºå¤åˆ©ç´¯è®¡æ”¶ç›Šç‡ï¼‰

### æ­¥éª¤2ï¼šä¿ç•™æœ‰æ„ä¹‰çš„æŒ‡æ ‡

ä¿ç•™å¹¶ä¼˜åŒ–ï¼š
- âœ… **å¹³å‡æ¯ç¬”æ”¶ç›Šç‡**ï¼š1.22%ï¼ˆç®€å•å¹³å‡ï¼‰
- âœ… **Sharpe Ratio**ï¼š2.10ï¼ˆé£é™©è°ƒæ•´æ”¶ç›Šï¼‰
- âœ… **Max Drawdown**ï¼šåŸºäºå¤åˆ©æ›²çº¿ï¼ˆéœ€è¦é‡æ–°è¯„ä¼°ï¼‰
- âœ… **Profit Factor**ï¼š2.67
- âœ… **Win Rate**ï¼š87.22%
- âœ… **æ€»ç›ˆäº**ï¼š$20,744

### æ­¥éª¤3ï¼šé‡æ–°è¯„ä¼° Max Drawdown

**é—®é¢˜**ï¼šMax Drawdown ä¹Ÿæ˜¯åŸºäºå¤åˆ©æ›²çº¿è®¡ç®—çš„ï¼Œå¯èƒ½ä¹Ÿæœ‰é—®é¢˜ã€‚

**å»ºè®®**ï¼š
- ä½¿ç”¨è´¦æˆ·ä»·å€¼æ›²çº¿è€Œéæ”¶ç›Šç‡æ›²çº¿
- æˆ–è€…åŸºäºç´¯è®¡PnLæ›²çº¿

### æ­¥éª¤4ï¼šæ·»åŠ è¯´æ˜æ–‡æ¡£

åœ¨æŠ¥å‘Šä¸­æ·»åŠ ï¼š
```markdown
## å…³äºç´¯è®¡æ”¶ç›Šç‡

âš ï¸ **ä¸ºä»€ä¹ˆä¸æ˜¾ç¤ºç´¯è®¡æ”¶ç›Šç‡ï¼Ÿ**

åŸºäºå•ç¬”äº¤æ˜“æ”¶ç›Šç‡çš„å¤åˆ©ç´¯è®¡æ”¶ç›Šç‡**ä¸èƒ½å‡†ç¡®åæ˜ æ€»ä½“è¡¨ç°**ã€‚

åŸå› ï¼š
1. å¤åˆ©è®¡ç®—å‡è®¾æ¯æ¬¡äº¤æ˜“éƒ½ä½¿ç”¨å…¨éƒ¨èµ„é‡‘
2. ä½†å®é™…æ¯ç¬”äº¤æ˜“çš„æŒä»“ä»·å€¼åªæ˜¯ä¸€éƒ¨åˆ†èµ„é‡‘
3. å¯¼è‡´å¤§é¢äºæŸäº¤æ˜“åœ¨å¤åˆ©é“¾ä¸­é€ æˆä¸æˆæ¯”ä¾‹çš„å½±å“

æˆ‘ä»¬æä¾›çš„æ›¿ä»£æŒ‡æ ‡ï¼š
- **å¹³å‡æ¯ç¬”æ”¶ç›Šç‡**ï¼šåæ˜ å¹³å‡æ°´å¹³
- **Sharpe Ratio**ï¼šåæ˜ é£é™©è°ƒæ•´æ”¶ç›Š
- **æ€»ç›ˆäº**ï¼šåæ˜ ç»å¯¹æ”¶ç›Š
```

## ä»£ç ä¿®æ”¹å»ºè®®

### 1. apex_fork.py

```python
# ä¿®æ”¹ _calculate_return_metrics_on_trades
def _calculate_return_metrics_on_trades(self, fills: List[Dict]) -> Dict[str, Any]:
    """
    è®¡ç®—åŸºäºäº¤æ˜“çš„æ”¶ç›Šç‡æŒ‡æ ‡

    âš ï¸ æ³¨æ„ï¼šä¸å†è®¡ç®—å¤åˆ©ç´¯è®¡æ”¶ç›Šç‡ï¼Œå› ä¸ºå®ƒåœ¨å½“å‰æ•°æ®ç»“æ„ä¸‹æ²¡æœ‰æ„ä¹‰
    """
    trade_returns = []
    trade_pnls = []
    trade_times = []

    for fill in fills:
        closed_pnl = float(fill.get('closedPnl', 0))
        if closed_pnl == 0:
            continue

        sz = float(fill.get('sz', 0))
        px = float(fill.get('px', 0))
        notional_value = abs(sz) * px

        if notional_value > 0:
            trade_return = closed_pnl / notional_value
            trade_return = max(trade_return, -0.999)  # é™åˆ¶ä¸‹é™
            trade_returns.append(trade_return)
            trade_pnls.append(closed_pnl)
            trade_times.append(fill.get('time', 0))

    if len(trade_returns) < 1:
        return {
            "mean_return": 0,
            "median_return": 0,
            "total_pnl": 0,
            "trading_days": 0
        }

    # ç®€å•ç»Ÿè®¡
    mean_return = sum(trade_returns) / len(trade_returns)
    median_return = sorted(trade_returns)[len(trade_returns) // 2]
    total_pnl = sum(trade_pnls)

    # è®¡ç®—äº¤æ˜“å¤©æ•°
    if len(trade_times) >= 2:
        first_time = min(trade_times)
        last_time = max(trade_times)
        trading_days = (last_time - first_time) / 1000 / 86400
    else:
        trading_days = 0

    return {
        "mean_return": mean_return,
        "median_return": median_return,
        "total_pnl": total_pnl,
        "trading_days": trading_days,
        "total_trades": len(trade_returns)
    }
```

### 2. main.py

```python
# ä¿®æ”¹æ˜¾ç¤ºé€»è¾‘
def display_account_info(analysis: AnalysisResults) -> None:
    """æ˜¾ç¤ºè´¦æˆ·ä¿¡æ¯"""
    # ...

    # æ”¶ç›Šç‡æŒ‡æ ‡
    return_metrics_on_trades = raw_results.get('return_metrics_on_trades', {})

    print(f"\n  â”Œâ”€ æ”¶ç›Šç‡æŒ‡æ ‡ï¼ˆåŸºäºå•ç¬”äº¤æ˜“ï¼‰")
    print("  â”‚")

    # å¹³å‡æ¯ç¬”æ”¶ç›Šç‡
    mean_return = return_metrics_on_trades.get('mean_return', 0)
    mean_return_icon = "ğŸ“ˆ" if mean_return >= 0 else "ğŸ“‰"
    print(f"  â”‚  å¹³å‡æ¯ç¬”æ”¶ç›Šç‡ {mean_return_icon}   {mean_return:>12.2%}")

    # ä¸­ä½æ•°æ”¶ç›Šç‡
    median_return = return_metrics_on_trades.get('median_return', 0)
    print(f"  â”‚  ä¸­ä½æ•°æ”¶ç›Šç‡       {median_return:>12.2%}")

    # æ€»ç›ˆäº
    total_pnl = return_metrics_on_trades.get('total_pnl', 0)
    print(f"  â”‚  æ€»ç›ˆäº             ${total_pnl:>12,.2f}")

    print("  â”‚")
    print(f"  â”‚  äº¤æ˜“å¤©æ•°            {return_metrics_on_trades.get('trading_days', 0):>12.1f}  å¤©")
    print(f"  â”‚  äº¤æ˜“ç¬”æ•°            {return_metrics_on_trades.get('total_trades', 0):>12}  ç¬”")

    print("\n  â„¹ï¸  è¯´æ˜:")
    print("  â€¢ æ”¶ç›Šç‡åŸºäºå•ç¬”äº¤æ˜“çš„æŒä»“ä»·å€¼è®¡ç®—")
    print("  â€¢ å¹³å‡æ¯ç¬”æ”¶ç›Šç‡ï¼šæ‰€æœ‰äº¤æ˜“æ”¶ç›Šç‡çš„ç®€å•å¹³å‡")
    print("  â€¢ ä¸æ˜¾ç¤ºç´¯è®¡æ”¶ç›Šç‡ï¼Œå› ä¸ºå¤åˆ©è®¡ç®—ä¸é€‚ç”¨äºå½“å‰æ•°æ®ç»“æ„")
```

## æ€»ç»“

1. **é—®é¢˜æœ¬è´¨**ï¼šç®—æ³•å‡è®¾ä¸å®é™…äº¤æ˜“æ¨¡å¼ä¸ç¬¦
2. **è¡¨ç°ç—‡çŠ¶**ï¼šç´¯è®¡æ”¶ç›Šç‡ä¸ºè´Ÿï¼Œä½†æ€»ç›ˆäºä¸ºæ­£
3. **æ ¹æœ¬åŸå› **ï¼šå¤åˆ©è®¡ç®—ä¸é€‚ç”¨äºæŒä»“ä»·å€¼å·®å¼‚å·¨å¤§çš„äº¤æ˜“åºåˆ—
4. **è§£å†³æ–¹æ¡ˆ**ï¼šç§»é™¤å¤åˆ©ç´¯è®¡æ”¶ç›Šç‡ï¼Œä½¿ç”¨ç®€å•å¹³å‡å’Œå…¶ä»–æœ‰æ„ä¹‰çš„æŒ‡æ ‡

**å…³é”®æ•™è®­**ï¼š
- âš ï¸ ä¸æ˜¯æ‰€æœ‰é‡‘èæŒ‡æ ‡éƒ½é€‚ç”¨äºæ‰€æœ‰åœºæ™¯
- âš ï¸ å¤åˆ©è®¡ç®—éœ€è¦æ»¡è¶³ç‰¹å®šå‡è®¾ï¼ˆå…¨éƒ¨èµ„é‡‘å‚ä¸æ¯æ¬¡æŠ•èµ„ï¼‰
- âœ… åº”è¯¥æ ¹æ®å®é™…æ•°æ®ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æŒ‡æ ‡
- âœ… Sharpe Ratioã€Profit Factorç­‰æŒ‡æ ‡æ›´é€‚åˆå½“å‰åœºæ™¯
