# ç´¯è®¡æ”¶ç›Šç‡ç®—æ³•è¯¦è§£ï¼ˆåŸºäºå•ç¬”äº¤æ˜“æ”¶ç›Šç‡ï¼‰

## ğŸ“Š ç®—æ³•æ¦‚è¿°

**ç´¯è®¡æ”¶ç›Šç‡ï¼ˆCumulative Returnï¼‰** æ˜¯è¡¡é‡äº¤æ˜“ç­–ç•¥æ•´ä½“è¡¨ç°çš„æ ¸å¿ƒæŒ‡æ ‡ï¼Œé€šè¿‡å¤åˆ©è®¡ç®—æ‰€æœ‰äº¤æ˜“çš„ç´¯ç§¯ç›ˆåˆ©æ•ˆæœï¼Œå®Œå…¨ä¸ä¾èµ–å¤–éƒ¨æœ¬é‡‘æ•°æ®ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**ï¼š
- âœ… å¤åˆ©è®¡ç®—ï¼šçœŸå®åæ˜ èµ„é‡‘å¢é•¿
- âœ… å®Œå…¨ç‹¬ç«‹ï¼šä¸ä¾èµ–æœ¬é‡‘æ•°æ®
- âœ… æ ‡å‡†åŒ–ï¼šåŸºäºå•ç¬”æ”¶ç›Šç‡
- âœ… å¯æ¯”æ€§ï¼šå¯è·¨è´¦æˆ·ã€è·¨ç­–ç•¥å¯¹æ¯”

**å…³é”®åŒºåˆ«**ï¼š
| æ–¹æ³• | å…¬å¼ | ç‰¹ç‚¹ |
|-----|------|------|
| **æ—§æ–¹æ³•** | ç®€å•ç´¯åŠ ï¼šÎ£æ”¶ç›Šç‡ | âŒ ä¸ç¬¦åˆç°å® |
| **æ–°æ–¹æ³•** | å¤åˆ©è®¡ç®—ï¼šâˆ(1+æ”¶ç›Šç‡)-1 | âœ… çœŸå®åæ˜ å¢é•¿ |

---

## ğŸ¯ æ ¸å¿ƒå…¬å¼

### åŸºç¡€å…¬å¼

```
ç´¯è®¡æ”¶ç›Šç‡ = âˆ(1 + ráµ¢) - 1
           = (1+râ‚) Ã— (1+râ‚‚) Ã— ... Ã— (1+râ‚™) - 1
```

**ç¬¦å·è¯´æ˜**ï¼š
- `âˆ` : è¿ä¹˜ç¬¦å·ï¼ˆProductï¼‰
- `ráµ¢` : ç¬¬ i ç¬”äº¤æ˜“çš„æ”¶ç›Šç‡
- `n` : äº¤æ˜“æ€»ç¬”æ•°
- `1 + ráµ¢` : èµ„é‡‘å¢é•¿å€æ•°

### å•ç¬”æ”¶ç›Šç‡è®¡ç®—

```
ráµ¢ = closedPnL / (|sz| Ã— px)
```

**å‚æ•°è¯´æ˜**ï¼š
- `closedPnL`: è¯¥ç¬”äº¤æ˜“çš„å·²å®ç°ç›ˆäºï¼ˆUSDï¼‰
- `sz`: äº¤æ˜“æ•°é‡ï¼ˆå¯ä¸ºæ­£æˆ–è´Ÿï¼‰
- `px`: äº¤æ˜“ä»·æ ¼ï¼ˆUSDï¼‰
- `|sz| Ã— px`: æŒä»“ä»·å€¼ï¼ˆåä¹‰ä»·å€¼ï¼ŒUSDï¼‰

---

## ğŸ’¡ ç®—æ³•åŸç†

### 1. ä¸ºä»€ä¹ˆä½¿ç”¨å¤åˆ©è€Œéç®€å•ç´¯åŠ ï¼Ÿ

#### ç®€å•ç´¯åŠ çš„é—®é¢˜

**é”™è¯¯æ–¹æ³•**ï¼š
```
ç´¯è®¡æ”¶ç›Šç‡ = râ‚ + râ‚‚ + râ‚ƒ + ...
```

**ç¤ºä¾‹**ï¼š
```
Trade 1: æ”¶ç›Šç‡ 10%
Trade 2: æ”¶ç›Šç‡ 10%
Trade 3: æ”¶ç›Šç‡ 10%

é”™è¯¯è®¡ç®—: 10% + 10% + 10% = 30%
```

âŒ **é—®é¢˜**ï¼š
1. æ²¡æœ‰è€ƒè™‘ç›ˆåˆ©çš„å†æŠ•èµ„æ•ˆåº”
2. æ— æ³•åæ˜ çœŸå®çš„èµ„é‡‘å¢é•¿
3. ä¸å®é™…æ”¶ç›Šä¸ç¬¦

#### å¤åˆ©è®¡ç®—çš„æ­£ç¡®æ€§

**æ­£ç¡®æ–¹æ³•**ï¼š
```
ç´¯è®¡æ”¶ç›Šç‡ = (1+râ‚) Ã— (1+râ‚‚) Ã— (1+râ‚ƒ) - 1
```

**åŒæ ·çš„ç¤ºä¾‹**ï¼š
```
Trade 1: æ”¶ç›Šç‡ 10%
Trade 2: æ”¶ç›Šç‡ 10%
Trade 3: æ”¶ç›Šç‡ 10%

æ­£ç¡®è®¡ç®—:
åˆå§‹: 1.0
Trade 1: 1.0 Ã— (1 + 0.10) = 1.10
Trade 2: 1.10 Ã— (1 + 0.10) = 1.21
Trade 3: 1.21 Ã— (1 + 0.10) = 1.331

ç´¯è®¡æ”¶ç›Šç‡ = 1.331 - 1 = 0.331 = 33.1%
```

âœ… **æ­£ç¡®**ï¼š
- åæ˜ äº†ç›ˆåˆ©çš„å†æŠ•èµ„
- ç¬¦åˆçœŸå®çš„èµ„é‡‘å¢é•¿è§„å¾‹
- ä¸å®é™…æ”¶ç›Šä¸€è‡´

### 2. å¤åˆ©æ•ˆåº”çš„å¨åŠ›

#### æ¡ˆä¾‹å¯¹æ¯”

**åœºæ™¯**ï¼š10ç¬”äº¤æ˜“ï¼Œæ¯ç¬”æ”¶ç›Šç‡ 5%

**ç®€å•ç´¯åŠ ï¼ˆé”™è¯¯ï¼‰**ï¼š
```
ç´¯è®¡ = 5% Ã— 10 = 50%
```

**å¤åˆ©è®¡ç®—ï¼ˆæ­£ç¡®ï¼‰**ï¼š
```
ç´¯è®¡ = (1.05)^10 - 1 = 1.6289 - 1 = 62.89%
```

**å·®å¼‚**ï¼š62.89% - 50% = **+12.89%**

è¿™å°±æ˜¯å¤åˆ©çš„å¨åŠ›ï¼

#### æ•°å­¦è¯æ˜

**èµ·å§‹èµ„é‡‘**ï¼š$10,000

**æ–¹æ³•1ï¼šç®€å•ç´¯åŠ ï¼ˆé”™è¯¯ï¼‰**
```
Trade 1: $10,000 Ã— 5% = $500    ä½™é¢: $10,500
Trade 2: $10,000 Ã— 5% = $500    ä½™é¢: $11,000
Trade 3: $10,000 Ã— 5% = $500    ä½™é¢: $11,500
...
Trade 10: $10,000 Ã— 5% = $500   ä½™é¢: $15,000

æ€»æ”¶ç›Š: $5,000 (50%)
```

**æ–¹æ³•2ï¼šå¤åˆ©è®¡ç®—ï¼ˆæ­£ç¡®ï¼‰**
```
Trade 1: $10,000 Ã— 5% = $500    ä½™é¢: $10,500
Trade 2: $10,500 Ã— 5% = $525    ä½™é¢: $11,025
Trade 3: $11,025 Ã— 5% = $551    ä½™é¢: $11,576
...
Trade 10: ä½™é¢: $16,289

æ€»æ”¶ç›Š: $6,289 (62.89%)
```

**é¢å¤–æ”¶ç›Š**ï¼š$1,289ï¼ˆæ¥è‡ªç›ˆåˆ©çš„å†æŠ•èµ„ï¼‰

### 3. è´Ÿæ”¶ç›Šçš„å¤„ç†

#### äºæŸå¯¹ç´¯è®¡æ”¶ç›Šçš„å½±å“

**ç¤ºä¾‹**ï¼š
```
Trade 1: +10%  â†’ ç´¯è®¡ = (1 + 0.10) = 1.10        (+10.0%)
Trade 2: -5%   â†’ ç´¯è®¡ = 1.10 Ã— (1 - 0.05) = 1.045  (+4.5%)
Trade 3: +8%   â†’ ç´¯è®¡ = 1.045 Ã— (1 + 0.08) = 1.129 (+12.9%)
```

**å…³é”®ç†è§£**ï¼š
- äºæŸä¼šä¾µèš€ç´¯è®¡æ”¶ç›Š
- å¤åˆ©è®¡ç®—è‡ªåŠ¨å¤„ç†æ­£è´Ÿæ”¶ç›Š
- äºæŸåéœ€è¦æ›´é«˜çš„ç›ˆåˆ©æ‰èƒ½æ¢å¤

#### å¯¹ç§°æ€§é—®é¢˜

**é‡è¦å‘ç°**ï¼šç›ˆäºä¸å¯¹ç§°ï¼

```
å…ˆç›ˆåˆ©åäºæŸ:
+50% â†’ -50%
= 1.5 Ã— 0.5 = 0.75 = -25%  âŒ å‡€äºæŸ

å…ˆäºæŸåç›ˆåˆ©:
-50% â†’ +50%
= 0.5 Ã— 1.5 = 0.75 = -25%  âŒ å‡€äºæŸ
```

**å¯ç¤º**ï¼š
- äºæŸ 50% éœ€è¦ç›ˆåˆ© 100% æ‰èƒ½å›æœ¬
- é£é™©æ§åˆ¶è‡³å…³é‡è¦
- é¿å…å¤§å¹…å›æ’¤

### 4. ä¸ºä»€ä¹ˆä¸ä¾èµ–æœ¬é‡‘ï¼Ÿ

#### ä¼ ç»Ÿæ–¹æ³•çš„é—®é¢˜

**åŸºäºæœ¬é‡‘è®¡ç®—**ï¼š
```
ç´¯è®¡æ”¶ç›Šç‡ = (å½“å‰è´¦æˆ·ä»·å€¼ - çœŸå®æœ¬é‡‘) / çœŸå®æœ¬é‡‘
```

âŒ **é—®é¢˜**ï¼š
1. éœ€è¦å‡†ç¡®çš„æœ¬é‡‘æ•°æ®
2. è´¦æœ¬è®°å½•å¯èƒ½ä¸å®Œæ•´
3. æœ¬é‡‘å¯èƒ½ä¸ºè´Ÿï¼ˆè½¬å‡º > è½¬å…¥ï¼‰
4. å—å‡ºå…¥é‡‘æ“ä½œå½±å“

#### æ–°æ–¹æ³•çš„ä¼˜åŠ¿

**åŸºäºäº¤æ˜“æ”¶ç›Šç‡**ï¼š
```
ç´¯è®¡æ”¶ç›Šç‡ = âˆ(1 + ráµ¢) - 1
å…¶ä¸­ ráµ¢ = closedPnL / (|sz| Ã— px)
```

âœ… **ä¼˜åŠ¿**ï¼š
1. æ¯ç¬”äº¤æ˜“ç‹¬ç«‹è®¡ç®—
2. ä¸éœ€è¦è´¦æœ¬æ•°æ®
3. å®Œå…¨ä¸å—å‡ºå…¥é‡‘å½±å“
4. æ•°æ®è‡ªåŒ…å«ï¼Œå‡†ç¡®å¯é 

---

## ğŸ”¬ ç®—æ³•å®ç°

### å®Œæ•´ä»£ç 

```python
def calculate_return_metrics_on_trades(self, fills: List[Dict]) -> Dict[str, float]:
    """
    åŸºäºå•ç¬”äº¤æ˜“æ”¶ç›Šç‡è®¡ç®—ç´¯è®¡å’Œå¹´åŒ–æ”¶ç›Šç‡ï¼ˆä¸ä¾èµ–æœ¬é‡‘ï¼‰

    è¿”å›ï¼š
        - cumulative_return: ç´¯è®¡æ”¶ç›Šç‡ï¼ˆå¤åˆ©ï¼‰â­
        - annualized_return: å¹´åŒ–æ”¶ç›Šç‡
        - trading_days: äº¤æ˜“å¤©æ•°
        - annualized_return_valid: å¹´åŒ–æ”¶ç›Šç‡æ˜¯å¦å¯é 
        - annualized_return_warnings: è­¦å‘Šåˆ—è¡¨
    """
    trade_returns = []
    trade_times = []

    # æ­¥éª¤1: è®¡ç®—æ¯ç¬”äº¤æ˜“çš„æ”¶ç›Šç‡
    for fill in fills:
        closed_pnl = float(fill.get('closedPnl', 0))
        if closed_pnl == 0:
            continue

        sz = float(fill.get('sz', 0))
        px = float(fill.get('px', 0))
        notional_value = abs(sz) * px

        if notional_value > 0:
            trade_return = closed_pnl / notional_value
            trade_returns.append(trade_return)
            trade_times.append(fill.get('time', 0))

    if len(trade_returns) < 1:
        return {
            "cumulative_return": 0,
            "annualized_return": 0,
            "trading_days": 0,
            "annualized_return_valid": False,
            "annualized_return_warnings": ["NO_TRADES"]
        }

    # æ­¥éª¤2: è®¡ç®—ç´¯è®¡æ”¶ç›Šç‡ï¼ˆå¤åˆ©ï¼‰â­
    cumulative = 1.0
    for ret in trade_returns:
        cumulative *= (1 + ret)  # å¤åˆ©ç´¯ç§¯
    cumulative_return = (cumulative - 1) * 100  # è½¬æ¢ä¸ºç™¾åˆ†æ¯”

    # æ­¥éª¤3: è®¡ç®—äº¤æ˜“å¤©æ•°
    if len(trade_times) >= 2:
        first_time = min(trade_times)
        last_time = max(trade_times)
        trading_days = (last_time - first_time) / 1000 / 86400
    else:
        trading_days = 0

    # æ­¥éª¤4: è®¡ç®—å¹´åŒ–æ”¶ç›Šç‡ï¼ˆå¸¦æº¢å‡ºä¿æŠ¤ï¼‰
    annualized_return = 0
    annualized_return_valid = True
    annualized_return_warnings = []

    if trading_days > 0:
        try:
            annual_factor = 365.0 / trading_days

            # åˆ†çº§è­¦å‘Š
            if trading_days < 1:
                annualized_return_valid = False
                annualized_return_warnings.append("LESS_THAN_1_DAY")
            elif trading_days < 7:
                annualized_return_valid = False
                annualized_return_warnings.append("LESS_THAN_7_DAYS")
            elif trading_days < 30:
                annualized_return_valid = False
                annualized_return_warnings.append("LESS_THAN_30_DAYS")

            # è®¡ç®—å¹´åŒ–æ”¶ç›Šç‡
            if annual_factor <= 100:
                annualized_return = (math.pow(cumulative, annual_factor) - 1) * 100

                # æ£€æŸ¥æç«¯å€¼
                if abs(annualized_return) > 5000:
                    annualized_return_valid = False
                    annualized_return_warnings.append("EXTREME_RETURN_VALUE")
                elif abs(annualized_return) > 1000:
                    annualized_return_valid = False
                    annualized_return_warnings.append("VERY_HIGH_RETURN_VALUE")
            else:
                annualized_return = (math.pow(cumulative, annual_factor) - 1) * 100
                annualized_return_valid = False
                annualized_return_warnings.append("VERY_SHORT_PERIOD")

        except (OverflowError, ValueError):
            annualized_return = 0
            annualized_return_valid = False
            annualized_return_warnings.append("CALCULATION_ERROR")
    else:
        annualized_return_valid = False
        annualized_return_warnings.append("NO_TIME_SPAN")

    return {
        "cumulative_return": cumulative_return,      # â­ ç´¯è®¡æ”¶ç›Šç‡
        "annualized_return": annualized_return,      # å¹´åŒ–æ”¶ç›Šç‡
        "trading_days": trading_days,
        "annualized_return_valid": annualized_return_valid,
        "annualized_return_warnings": annualized_return_warnings
    }
```

### å…³é”®æ­¥éª¤è¯¦è§£

#### æ­¥éª¤1: è®¡ç®—å•ç¬”æ”¶ç›Šç‡

```python
for fill in fills:
    closed_pnl = float(fill.get('closedPnl', 0))
    if closed_pnl == 0:
        continue  # è·³è¿‡å¼€ä»“äº¤æ˜“

    sz = float(fill.get('sz', 0))
    px = float(fill.get('px', 0))
    notional_value = abs(sz) * px  # æŒä»“ä»·å€¼

    if notional_value > 0:
        trade_return = closed_pnl / notional_value
        trade_returns.append(trade_return)
```

**è¾“å‡º**ï¼š
```python
trade_returns = [0.025, 0.04, -0.015, 0.03, ...]
```

#### æ­¥éª¤2: å¤åˆ©è®¡ç®—ç´¯è®¡æ”¶ç›Šç‡ â­

```python
cumulative = 1.0  # èµ·å§‹å€æ•°
for ret in trade_returns:
    cumulative *= (1 + ret)  # è¿ä¹˜

cumulative_return = (cumulative - 1) * 100  # è½¬æ¢ä¸ºç™¾åˆ†æ¯”
```

**é€æ­¥æ¼”ç¤º**ï¼š
```python
trade_returns = [0.05, 0.03, -0.02, 0.04]

åˆå§‹:     cumulative = 1.0
Trade 1:  cumulative = 1.0 Ã— (1 + 0.05) = 1.05
Trade 2:  cumulative = 1.05 Ã— (1 + 0.03) = 1.0815
Trade 3:  cumulative = 1.0815 Ã— (1 - 0.02) = 1.05987
Trade 4:  cumulative = 1.05987 Ã— (1 + 0.04) = 1.102265

ç´¯è®¡æ”¶ç›Šç‡ = (1.102265 - 1) Ã— 100 = 10.23%
```

#### æ­¥éª¤3: è®¡ç®—äº¤æ˜“å¤©æ•°

```python
if len(trade_times) >= 2:
    first_time = min(trade_times)
    last_time = max(trade_times)
    trading_days = (last_time - first_time) / 1000 / 86400
else:
    trading_days = 0
```

**æ³¨æ„**ï¼š
- `trade_times` å•ä½æ˜¯æ¯«ç§’
- è½¬æ¢ä¸ºå¤©æ•°ï¼š`/ 1000 / 86400`

#### æ­¥éª¤4: è®¡ç®—å¹´åŒ–æ”¶ç›Šç‡

```python
annual_factor = 365.0 / trading_days
annualized_return = (math.pow(cumulative, annual_factor) - 1) * 100
```

**å…¬å¼**ï¼š
```
å¹´åŒ–æ”¶ç›Šç‡ = (1 + ç´¯è®¡æ”¶ç›Šç‡)^(365/äº¤æ˜“å¤©æ•°) - 1
```

**ç¤ºä¾‹**ï¼š
```
ç´¯è®¡æ”¶ç›Šç‡ = 20% (0.2)
äº¤æ˜“å¤©æ•° = 100 å¤©
annual_factor = 365 / 100 = 3.65

å¹´åŒ–æ”¶ç›Šç‡ = (1.2)^3.65 - 1
          = 2.067 - 1
          = 1.067 = 106.7%
```

---

## ğŸ“ˆ å®é™…åº”ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹ 1: ç¨³å®šç›ˆåˆ©ç­–ç•¥

**äº¤æ˜“è®°å½•**ï¼š
```
Trade 1:  sz=10, px=$2000, PnL=$400   â†’ râ‚ = 400/(10Ã—2000) = 2.0%
Trade 2:  sz=8,  px=$2100, PnL=$336   â†’ râ‚‚ = 336/(8Ã—2100)  = 2.0%
Trade 3:  sz=12, px=$1900, PnL=$456   â†’ râ‚ƒ = 456/(12Ã—1900) = 2.0%
Trade 4:  sz=6,  px=$2050, PnL=$246   â†’ râ‚„ = 246/(6Ã—2050)  = 2.0%
Trade 5:  sz=9,  px=$2020, PnL=$364   â†’ râ‚… = 364/(9Ã—2020)  = 2.0%
```

**ç®€å•ç´¯åŠ ï¼ˆé”™è¯¯ï¼‰**ï¼š
```
ç´¯è®¡æ”¶ç›Šç‡ = 2% + 2% + 2% + 2% + 2% = 10.0%
```

**å¤åˆ©è®¡ç®—ï¼ˆæ­£ç¡®ï¼‰**ï¼š
```
ç´¯è®¡ = (1.02)^5 - 1
     = 1.10408 - 1
     = 0.10408 = 10.41%
```

**å¤åˆ©æ”¶ç›Š**ï¼š10.41% - 10.0% = **+0.41%**

**è§£è¯»**ï¼š
- æ¯ç¬”ç¨³å®šç›ˆåˆ© 2%
- å¤åˆ©æ•ˆåº”å¸¦æ¥é¢å¤– 0.41% æ”¶ç›Š
- ç­–ç•¥è¡¨ç°ä¼˜ç§€ä¸”ç¨³å®š

### æ¡ˆä¾‹ 2: æ³¢åŠ¨ç­–ç•¥

**äº¤æ˜“è®°å½•**ï¼š
```
Trade 1:  râ‚ = +10%
Trade 2:  râ‚‚ = -5%
Trade 3:  râ‚ƒ = +8%
Trade 4:  râ‚„ = -3%
Trade 5:  râ‚… = +12%
```

**ç®€å•ç´¯åŠ ï¼ˆé”™è¯¯ï¼‰**ï¼š
```
ç´¯è®¡ = 10% - 5% + 8% - 3% + 12% = 22%
```

**å¤åˆ©è®¡ç®—ï¼ˆæ­£ç¡®ï¼‰**ï¼š
```
ç´¯è®¡ = (1.10) Ã— (0.95) Ã— (1.08) Ã— (0.97) Ã— (1.12) - 1
     = 1.10 Ã— 0.95 = 1.045
     = 1.045 Ã— 1.08 = 1.1286
     = 1.1286 Ã— 0.97 = 1.0947
     = 1.0947 Ã— 1.12 = 1.2261
     = 1.2261 - 1 = 0.2261 = 22.61%
```

**å·®å¼‚**ï¼š22.61% - 22% = **+0.61%**

**è§£è¯»**ï¼š
- æœ‰ç›ˆæœ‰äºï¼Œæ•´ä½“æ­£å‘
- å¤åˆ©æ•ˆåº”ä¾ç„¶æ˜æ˜¾
- æ³¢åŠ¨æ€§éœ€è¦å…³æ³¨

### æ¡ˆä¾‹ 3: çœŸå®æ•°æ®ï¼ˆæµ‹è¯•åœ°å€ï¼‰

**åœ°å€**: `0x67e4d5c95fdd024d136d520b3432ad0f94ed5081`

**äº¤æ˜“æ•°æ®**ï¼š
- äº¤æ˜“ç¬”æ•°ï¼š35 ç¬”
- èƒœç‡ï¼š100%ï¼ˆæ— äºæŸäº¤æ˜“ï¼‰
- å¹³å‡æ¯ç¬”æ”¶ç›Šç‡ï¼š15.82%

**è®¡ç®—è¿‡ç¨‹**ï¼š
```python
# ç®€åŒ–è®¡ç®—ï¼ˆå‡è®¾æ¯ç¬”éƒ½æ˜¯15.82%ï¼Œå®é™…æœ‰æ³¢åŠ¨ï¼‰
ä¼°ç®— = (1.1582)^35 - 1
     â‰ˆ 322.26%
```

**å®é™…ç»“æœ**ï¼š
```
ç´¯è®¡æ”¶ç›Šç‡: 322.26% âœ…
äº¤æ˜“å¤©æ•°: 0.0 å¤©ï¼ˆåŒæ—¥äº¤æ˜“ï¼‰
å¹´åŒ–æ”¶ç›Šç‡: 0% ï¼ˆè­¦å‘Šï¼šäº¤æ˜“æ—¶é—´å¤ªçŸ­ï¼‰
```

**è§£è¯»**ï¼š
- æä¼˜ç§€çš„çŸ­æœŸè¡¨ç°
- å¤åˆ©æ•ˆåº”æ˜¾è‘—ï¼ˆ35ç¬”è¿èƒœï¼‰
- å¹´åŒ–æ”¶ç›Šç‡å› äº¤æ˜“æ—¶é—´å¤ªçŸ­è€Œä¸å¯é 

---

## ğŸ“Š æŒ‡æ ‡è§£è¯»

### ç´¯è®¡æ”¶ç›Šç‡çš„å«ä¹‰

| æ•°å€¼èŒƒå›´ | è¯„çº§ | è¯´æ˜ |
|---------|------|------|
| > 100% | ğŸŸ¢ æä¼˜ç§€ | èµ„é‡‘ç¿»å€ä»¥ä¸Š |
| 50% - 100% | ğŸŸ¢ ä¼˜ç§€ | éå¸¸å¥½çš„æ”¶ç›Š |
| 20% - 50% | ğŸŸ¡ è‰¯å¥½ | å¯æ¥å—çš„æ”¶ç›Š |
| 0% - 20% | ğŸŸ¡ ä¸€èˆ¬ | æ”¶ç›Šè¾ƒä½ |
| < 0% | ğŸ”´ äºæŸ | éœ€è¦æ”¹è¿› |

### æ—¶é—´å› ç´ çš„å½±å“

**é‡è¦**ï¼šå¿…é¡»ç»“åˆäº¤æ˜“å¤©æ•°è¯„ä¼°ï¼

| ç´¯è®¡æ”¶ç›Šç‡ | äº¤æ˜“å¤©æ•° | è¯„çº§ |
|-----------|---------|------|
| 50% | 365 å¤© | ğŸŸ¢ è‰¯å¥½ï¼ˆ50% APRï¼‰ |
| 50% | 180 å¤© | ğŸŸ¢ ä¼˜ç§€ï¼ˆ121% APRï¼‰ |
| 50% | 30 å¤© | ğŸŸ¢ æä¼˜ç§€ï¼ˆ5478% APRï¼‰ |
| 50% | 1 å¤© | âš ï¸ ä¸å¯æŒç»­ |

**å…¬å¼**ï¼š
```
å¹´åŒ–æ”¶ç›Šç‡ = (1 + ç´¯è®¡æ”¶ç›Šç‡)^(365/äº¤æ˜“å¤©æ•°) - 1
```

### ä¸å…¶ä»–æŒ‡æ ‡çš„å…³ç³»

#### 1. ä¸å¹³å‡æ¯ç¬”æ”¶ç›Šç‡

**å…³ç³»**ï¼š
```
å¦‚æœæ¯ç¬”æ”¶ç›Šç‡ç›¸åŒ = r
ç´¯è®¡æ”¶ç›Šç‡ = (1 + r)^n - 1
```

**ç¤ºä¾‹**ï¼š
```
å¹³å‡æ¯ç¬”: 5%
äº¤æ˜“ç¬”æ•°: 10
ç´¯è®¡ â‰ˆ (1.05)^10 - 1 = 62.89%
```

**ä½†å®é™…ä¸Š**ï¼š
- æ¯ç¬”æ”¶ç›Šç‡ä¸ç›¸åŒ
- éœ€è¦é€ç¬”å¤åˆ©è®¡ç®—
- ä¸èƒ½ç®€å•ç”¨å…¬å¼ä¼°ç®—

#### 2. ä¸æœ€å¤§å›æ’¤

**ç´¯è®¡æ”¶ç›Šç‡æ›²çº¿**ç”¨äºè®¡ç®—æœ€å¤§å›æ’¤ï¼š

```
åˆå§‹: 1.0
Trade 1: 1.0 Ã— (1 + râ‚) = câ‚
Trade 2: câ‚ Ã— (1 + râ‚‚) = câ‚‚
...
```

**æœ€å¤§å›æ’¤** = å³°å€¼åˆ°è°·åº•çš„æœ€å¤§è·Œå¹…

#### 3. ä¸ Sharpe Ratio

**Sharpe Ratio** ä½¿ç”¨å•ç¬”æ”¶ç›Šç‡çš„å‡å€¼å’Œæ ‡å‡†å·®ï¼š
```
Sharpe = (mean_return - rf) / std_return
```

**ç´¯è®¡æ”¶ç›Šç‡** åæ˜ æ€»ä½“æ•ˆæœï¼š
```
ç´¯è®¡æ”¶ç›Šç‡ = âˆ(1 + ráµ¢) - 1
```

**å…³ç³»**ï¼š
- Sharpe é«˜ + ç´¯è®¡æ”¶ç›Šé«˜ â†’ ğŸŸ¢ æœ€ä¼˜ç­–ç•¥
- Sharpe ä½ + ç´¯è®¡æ”¶ç›Šé«˜ â†’ ğŸŸ¡ é«˜é£é™©é«˜å›æŠ¥
- Sharpe é«˜ + ç´¯è®¡æ”¶ç›Šä½ â†’ ğŸŸ¡ ç¨³å¥ä½†æ”¶ç›Šå¼±

---

## ğŸ¯ å¹´åŒ–æ”¶ç›Šç‡è¯¦è§£

### å¹´åŒ–å…¬å¼

```
å¹´åŒ–æ”¶ç›Šç‡ = (1 + ç´¯è®¡æ”¶ç›Šç‡)^(365/äº¤æ˜“å¤©æ•°) - 1
```

### åˆ†çº§è­¦å‘Šç³»ç»Ÿ

æ ¹æ®äº¤æ˜“å¤©æ•°çš„å¯é æ€§åˆ†çº§ï¼š

| äº¤æ˜“å¤©æ•° | è­¦å‘Šæ ‡è®° | UI æ˜¾ç¤º | å¯é æ€§ |
|---------|---------|---------|--------|
| < 1 å¤© | LESS_THAN_1_DAY | ğŸ”´ | æä¸å¯é  |
| < 7 å¤© | LESS_THAN_7_DAYS | ğŸ”´ | ä¸é€‚åˆå¹´åŒ– |
| < 30 å¤© | LESS_THAN_30_DAYS | ğŸŸ¡ | ä»…ä¾›å‚è€ƒ |
| â‰¥ 30 å¤© | - | âœ… | è¾ƒä¸ºå¯é  |

**æç«¯å€¼æ£€æµ‹**ï¼š

| å¹´åŒ–æ”¶ç›Šç‡ | è­¦å‘Šæ ‡è®° | UI æ˜¾ç¤º | è¯´æ˜ |
|-----------|---------|---------|------|
| > 5000% | EXTREME_RETURN_VALUE | ğŸŸ¡ | æé«˜å€¼ï¼Œéœ€æ ¸å® |
| > 1000% | VERY_HIGH_RETURN_VALUE | ğŸŸ¡ | è¾ƒé«˜å€¼ï¼Œéœ€éªŒè¯ |

### ç¤ºä¾‹ï¼šä¸åŒæ—¶é—´è·¨åº¦

**åœºæ™¯**ï¼šç´¯è®¡æ”¶ç›Šç‡ = 20%

```
äº¤æ˜“å¤©æ•° = 365 å¤©:
å¹´åŒ– = (1.2)^(365/365) - 1 = 20%  âœ… å¯é 

äº¤æ˜“å¤©æ•° = 100 å¤©:
å¹´åŒ– = (1.2)^(365/100) - 1 = 106.7%  âœ… å¯é 

äº¤æ˜“å¤©æ•° = 30 å¤©:
å¹´åŒ– = (1.2)^(365/30) - 1 = 26,851%  ğŸŸ¡ ä»…ä¾›å‚è€ƒ

äº¤æ˜“å¤©æ•° = 7 å¤©:
å¹´åŒ– = (1.2)^(365/7) - 1 = 2.5Ã—10^9%  ğŸ”´ ä¸å¯é 
```

**ç»“è®º**ï¼š
- äº¤æ˜“å¤©æ•°è¶Šé•¿ï¼Œå¹´åŒ–æ”¶ç›Šç‡è¶Šå¯é 
- çŸ­æœŸæš´åˆ©ä¸ä»£è¡¨å¯æŒç»­
- å»ºè®®è‡³å°‘ 30 å¤©ä»¥ä¸Šæ‰å‚è€ƒå¹´åŒ–æŒ‡æ ‡

---

## ğŸ” å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¸ç”¨ç®€å•ç´¯åŠ ï¼Ÿ

**ç­”**ï¼šç®€å•ç´¯åŠ å¿½ç•¥äº†å¤åˆ©æ•ˆåº”ã€‚

**å¯¹æ¯”**ï¼š
```
3ç¬”äº¤æ˜“ï¼Œæ¯ç¬” +10%

ç®€å•ç´¯åŠ :
10% + 10% + 10% = 30%

å¤åˆ©è®¡ç®—:
(1.1) Ã— (1.1) Ã— (1.1) - 1 = 33.1%

å·®å¼‚: 3.1% çš„å¤åˆ©æ”¶ç›Šè¢«å¿½ç•¥äº†ï¼
```

### Q2: ç´¯è®¡æ”¶ç›Šç‡ä¼šè¶…è¿‡ 100% å—ï¼Ÿ

**ç­”**ï¼šä¼šçš„ï¼è¶…è¿‡ 100% è¡¨ç¤ºèµ„é‡‘ç¿»å€ä»¥ä¸Šã€‚

**ç¤ºä¾‹**ï¼š
```
ç´¯è®¡æ”¶ç›Šç‡ = 150%
å«ä¹‰: èµ„é‡‘å¢é•¿åˆ°åŸæ¥çš„ 2.5 å€

åˆå§‹: $10,000
æœ€ç»ˆ: $10,000 Ã— (1 + 1.5) = $25,000
```

### Q3: è´Ÿç´¯è®¡æ”¶ç›Šç‡æ€ä¹ˆç†è§£ï¼Ÿ

**ç­”**ï¼šè¡¨ç¤ºæ•´ä½“äºæŸã€‚

**ç¤ºä¾‹**ï¼š
```
ç´¯è®¡æ”¶ç›Šç‡ = -30%
å«ä¹‰: èµ„é‡‘ç¼©æ°´åˆ°åŸæ¥çš„ 70%

åˆå§‹: $10,000
æœ€ç»ˆ: $10,000 Ã— (1 - 0.3) = $7,000
```

### Q4: å¦‚ä½•ä»ç´¯è®¡æ”¶ç›Šç‡æ¢å¤åˆ° cumulative å€¼ï¼Ÿ

**ç­”**ï¼š
```
cumulative = 1 + ç´¯è®¡æ”¶ç›Šç‡

ä¾‹å­:
ç´¯è®¡æ”¶ç›Šç‡ = 50% = 0.5
cumulative = 1 + 0.5 = 1.5 (150% çš„æœ¬é‡‘)
```

### Q5: äº¤æ˜“é¡ºåºä¼šå½±å“ç´¯è®¡æ”¶ç›Šç‡å—ï¼Ÿ

**ç­”**ï¼šä¸ä¼šï¼ä¹˜æ³•æ»¡è¶³äº¤æ¢å¾‹ã€‚

**è¯æ˜**ï¼š
```
é¡ºåº A: (+10%) â†’ (-5%)
= 1.1 Ã— 0.95 = 1.045 = +4.5%

é¡ºåº B: (-5%) â†’ (+10%)
= 0.95 Ã— 1.1 = 1.045 = +4.5%

ç»“æœç›¸åŒï¼
```

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### å¦‚ä½•æé«˜ç´¯è®¡æ”¶ç›Šç‡ï¼Ÿ

#### 1. æé«˜å¹³å‡æ¯ç¬”æ”¶ç›Šç‡
- ä¼˜åŒ–å…¥åœºå’Œå‡ºåœºæ—¶æœº
- æ”¹è¿›æ­¢ç›ˆæ­¢æŸç­–ç•¥
- é€‰æ‹©æ›´å¥½çš„äº¤æ˜“å“ç§

#### 2. å¢åŠ äº¤æ˜“é¢‘ç‡
- åœ¨é£é™©å¯æ§çš„å‰æä¸‹
- å¢åŠ äº¤æ˜“æœºä¼š
- å¤åˆ©æ•ˆåº”ä¼šæ›´æ˜æ˜¾

#### 3. é™ä½äºæŸäº¤æ˜“çš„æŸå¤±
- ä¸¥æ ¼æ­¢æŸçºªå¾‹
- é¿å…å¤§é¢äºæŸ
- ä¿æŠ¤å·²æœ‰æ”¶ç›Š

#### 4. ä¿æŒç­–ç•¥çš„ä¸€è‡´æ€§
- ä¸è¦é¢‘ç¹æ”¹å˜ç­–ç•¥
- åšæŒæœ‰æ­£æœŸæœ›çš„æ–¹æ³•
- ç§¯ç´¯å¤åˆ©æ•ˆåº”

### å¤åˆ©çš„æ—¶é—´ä»·å€¼

**ç¤ºä¾‹**ï¼šæ¯ç¬”å¹³å‡ 2% æ”¶ç›Š

```
10 ç¬”:  (1.02)^10  - 1 = 21.9%
50 ç¬”:  (1.02)^50  - 1 = 169.2%
100 ç¬”: (1.02)^100 - 1 = 624.5%
200 ç¬”: (1.02)^200 - 1 = 5,148.0%
```

**å¯ç¤º**ï¼š
- æ—¶é—´æ˜¯å¤åˆ©çš„å¥½æœ‹å‹
- ç¨³å®šçš„å°æ”¶ç›Š > å¶å°”çš„å¤§æ”¶ç›Š
- åšæŒé•¿æœŸäº¤æ˜“

---

## ğŸ”— ä»£ç ä½ç½®

**å‡½æ•°**: `ApexCalculator.calculate_return_metrics_on_trades()`
**æ–‡ä»¶**: `apex_fork.py`
**è¡Œæ•°**: ~1260-1331

**è°ƒç”¨é“¾**:
```
main.py
  â””â”€ analyze_user_trading()
      â””â”€ ApexCalculator.analyze_user()
          â””â”€ ApexCalculator.calculate_return_metrics_on_trades()
              â””â”€ cumulative_return  â­
```

---

## ğŸ“š ç›¸å…³ç®—æ³•

1. **å¹³å‡æ¯ç¬”æ”¶ç›Šç‡ç®—æ³•** (`å¹³å‡æ¯ç¬”æ”¶ç›Šç‡ç®—æ³•è¯¦è§£.md`)
   - æä¾›å•ç¬”æ”¶ç›Šç‡ ráµ¢

2. **æœ€å¤§å›æ’¤ç®—æ³•** (`æœ€å¤§å›æ’¤ç®—æ³•è¯¦è§£.md`)
   - ä½¿ç”¨ç´¯è®¡æ”¶ç›Šç‡æ›²çº¿

3. **å¤æ™®æ¯”ç‡ç®—æ³•** (`å¤æ™®æ¯”ç‡ç®—æ³•è¯¦è§£.md`)
   - ä½¿ç”¨å•ç¬”æ”¶ç›Šç‡çš„ç»Ÿè®¡ç‰¹å¾

---

## ğŸ“– å‚è€ƒèµ„æ–™

- **æ•°å­¦åŸºç¡€**: å¤åˆ©è®¡ç®—ã€å‡ ä½•å¹³å‡
- **é‡‘èç†è®º**: æ—¶é—´ä»·å€¼ã€å¤åˆ©æ•ˆåº”
- **è¡Œä¸šæ ‡å‡†**: ç´¯è®¡æ”¶ç›Šç‡è®¡ç®—æ–¹æ³•

---

*ç®—æ³•æ–‡æ¡£ç‰ˆæœ¬: v2.0*
*åˆ›å»ºæ—¶é—´: 2026-02-04*
*ä½œè€…: Claude Sonnet 4.5*
